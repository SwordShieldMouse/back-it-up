#!/bin/bash
#SBATCH --job-name=Swimmer_fkl
#SBATCH --output=./logs/Swimmer/fkl/%A%a.out
#SBATCH --error=./logs/Swimmer/fkl/%A%a.err

#SBATCH --array=0-682:4

#SBATCH --cpus-per-task=4
#SBATCH --time=5:00:00
#SBATCH --mem-per-cpu=8000M

#SBATCH --account=rrg-whitem

ENV_NAME=Swimmer-v2
AGENT_NAME=forward_kl_big

ERROR_RUNS=(1540 1680 1820 1960 2100 2380 2520 2660 2800 2940 3220 3360 3500 3640 3780 3920 4060 1681 1821 1961 2101 2241 2381 2661 2941 3081 3361 3501 3641 3781 3921 4061 1542 1682 1822 2102 2242 2522 2662 2802 3082 3222 1963 2103 2243 2383 2663 2943 3083 3223 3363 3503 3643 3923 4063 1404 1544 1684 1824 1964 2104 2244 2384 2524 2664 2804 2944 3084 3364 3504 3644 3924 4064 1545 1825 2245 2525 2665 2805 2945 3085 3225 3365 3505 3645 3785 3925 4065 1406 2246 2946 3226 3366 3646 3926 4066 1968 2108 2248 2388 2528 2668 3088 3228 3368 3508 3648 3928 4068 1409 1549 1689 1969 2109 2249 2389 2529 2949 3089 3229 3649 3789 1420 1560 1840 2260 2400 2540 2680 2820 2960 3100 3240 3380 3520 3940 4080 1561 1701 1841 1981 2401 2541 2681 2821 2961 3101 3241 3381 3521 3661 3941 4081 1982 2122 2402 2822 3102 3242 4082 1423 1563 1843 2123 2263 2403 2683 2963 3243 3383 3523 3663 3803 3943 4083 1424 1704 1844 1984 2124 2264 2404 2544 2964 3384 3524 3664 3804 4084 1425 1565 1705 1845 1985 2265 2405 2545 2965 3105 3245 3385 3525 3805 3945 4085 1848 1988 2128 2268 3108 3248 3388 3528 3808 3948 1569 1849 2269 2409 2549 2276 2416 2556 2696 1440 1580 1720 1860 2000 2140 2560 2700 2840 2980 3120 3260 3400 3680 3820 3960 4100 1441 1721 1861 2001 2281 2561 2701 2841 2981 3121 3401 3541 3681 3961 4101 1862 2002 2142 2282 1863 2003 2143 2283 2423 2563 2703 2983 3263 3543 3683 3823 3963 4103 1584 1724 1864 2004 2284 2424 2564 2844 2984 3124 3404 3544 3684 3824 3964 4104 1585 1725 2005 2285 2425 2565 2705 2845 2985 3125 3405 3545 3685 3825 3965 4105 3686 3826 3966 1447 3127 3407 3687 3967 3548 1460 1600 1880 2020 2160 2300 2440 2580 2720 2860 3000 3140 3280 3560 3700 3840 4120 1461 1601 2021 2161 2441 2861 3001 3141 3281 3561 3701 3841 3981 1882 2302 2442 1885 2165 3005 3145 3285 3425 3565 3705 3845 4125 2877 3157 3437 1620 1760 2180 2320 2460 2600 2740 2880 3020 3300 3580 3720 3860 4000 4140 1481 1621 2041 2181 2461 2601 2741 2881 3021 3161 3301 3441 3581 3721 3861 4001 4141 1622 2742 2882 3442 3582 3722 3862 4142 1483 1623 1763 1903 2043 2183 2323 2603 3023 3163 3303 3583 3863 4003 4143 1484 1624 1904 2044 2324 2464 2604 2744 2884 3024 3164 3304 3444 3584 3724 3864 4004 4144 1485 1625 1765 1905 2045 2325 2605 2745 3165 3305 3445 3725 1487 2047 2187 2327 1768 1908 3453 3593 3733 3873 1915 2055 2195 2335 1640 1920 2060 2200 2340 2480 2620 2760 2900 3180 3320 3460 3600 3880 4160 1501 1641 2061 2201 2341 2481 2621 2761 2901 3181 3321 3601 3741 3881 4021 4161 1642 2062 2202 2342 2482 2762 2902 3042 3182 3322 2203 2343 2483 2623 2763 2903 3043 3183 3323 3463 3603 3743 3883 4023 4163 1504 1784 1924 2204 2344 2484 2764 2904 3044 3184 3324 3464 3604 3884 4164 1505 1645 1785 1925 2065 2205 2485 2625 2765 2905 3045 3325 3465 3885 2066 2206 2346 2486 3186 3326 3466 3606 3746 4026 4166 1647 1788 1928 2068 2208 2209 2349 2769 3192 3332 3472 3612 1520 1660 1800 1940 2080 2220 2360 2500 2920 3060 3200 3340 3480 3760 3900 4040 4180 1521 1661 1801 1941 2361 2501 2781 2921 3061 3201 3341 3481 3621 3901 4041 4181 1522 1942 2082 2222 2502 3342 3482 4182 1523 1803 2083 2223 2363 2643 2783 3203 3343 3483 3623 3763 4043 4183 1524 1664 1804 2084 2224 2364 2504 2784 3064 3204 3344 3484 3624 3764 3904 4044 4184 1525 1665 1805 2085 2225 2365 2505 2645 2925 3345 3485 3625 3765 3905 4045 4185 3347 3487 3627 3767 3907 4187 1668 2648 3068 3348 3488 2655 2935 3075 3215 2516 2656 2796 2936 3776 3916 4056 4196 2658 2798 2938 3078)

echo Running..$ENV_NAME $AGENT_NAME $SLURM_ARRAY_TASK_ID

export OMP_NUM_THREADS=1
export MKL_NUM_THREADS=1

THESE_ERROR_RUNS=()

let "end_idx=$SLURM_ARRAY_TASK_ID+3"
for ((i=$SLURM_ARRAY_TASK_ID; i<= $end_idx; i++)); do
    THESE_ERROR_RUNS+=( ${ERROR_RUNS[$i]} )
done

increment=1

parallel --jobs 4 "source ~/sungsu_env/bin/activate; bash experiments/continuous_deep_control/slurm_scripts/run_script_template.sh $ENV_NAME $AGENT_NAME {}" ::: ${THESE_ERROR_RUNS[@]}
